<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>古早味粿坊 - 製作小遊戲</title>
    <style>
        :root { --main-bg: #fff9f0; --box-bg: #ffffff; --accent: #d32f2f; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: var(--main-bg); margin: 0; display: flex; flex-direction: column; align-items: center; }
        
        /* 食材區 */
        .header-ui { display: flex; gap: 20px; padding: 20px; background: var(--box-bg); border-radius: 0 0 20px 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); width: 90%; max-width: 800px; }
        .ingredient-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; flex: 1; }
        .filling-area { display: flex; flex-direction: column; gap: 10px; width: 100px; }
        
        .item { border: 2px solid #eee; border-radius: 10px; padding: 5px; cursor: pointer; transition: 0.2s; position: relative; text-align: center; }
        .item:hover { transform: scale(1.05); border-color: var(--accent); }
        .item img { width: 60px; height: 60px; object-fit: contain; }
        .badge { position: absolute; top: -5px; right: -5px; background: var(--accent); color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: none; }

        /* 蒸籠區 */
        .steamer-container { margin-top: 50px; position: relative; width: 300px; height: 300px; display: flex; justify-content: center; align-items: center; }
        .steamer-img { width: 250px; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.1)); }
        #result-display { position: absolute; top: 40px; width: 120px; z-index: 10; display: none; animation: popIn 0.5s cubic-bezier(0.17, 0.67, 0.83, 0.67); }

        /* 按鈕區 */
        .action-btns { margin-top: 30px; display: flex; gap: 15px; }
        button { padding: 10px 25px; border-radius: 50px; border: none; cursor: pointer; font-size: 16px; font-weight: bold; }
        .btn-make { background: var(--accent); color: white; }
        .btn-reset { background: #795548; color: white; }

        /* 彈窗樣式 */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 100; }
        .modal { background: white; padding: 30px; border-radius: 20px; text-align: center; max-width: 400px; width: 80%; }
        
        @keyframes popIn { from { transform: scale(0) rotate(-20deg); opacity: 0; } to { transform: scale(1) rotate(0deg); opacity: 1; } }
    </style>
</head>
<body>

    <div class="header-ui">
        <div class="ingredient-grid">
            <div class="item" onclick="addIngredient('red')"><img src="紅米糰.png" alt="紅米糰"><div id="count-red" class="badge">0</div></div>
            <div class="item" onclick="addIngredient('white')"><img src="白米糰.png" alt="白米糰"><div id="count-white" class="badge">0</div></div>
            <div class="item" onclick="addIngredient('green')"><img src="綠米糰.png" alt="綠米糰"><div id="count-green" class="badge">0</div></div>
            <div class="item" onclick="addIngredient('syrup')"><img src="米漿.jpg" alt="米漿"><div id="count-syrup" class="badge">0</div></div>
        </div>
        <div class="filling-area">
            <div class="item" onclick="addIngredient('sweet')"><img src="甜陷.jpg" alt="甜餡"><div id="count-sweet" class="badge">0</div></div>
            <div class="item" onclick="addIngredient('salty')"><img src="鹹陷.png" alt="鹹餡"><div id="count-salty" class="badge">0</div></div>
        </div>
    </div>

    <div class="steamer-container">
        <img src="https://cdn-icons-png.flaticon.com/512/3227/3227094.png" class="steamer-img" alt="蒸籠">
        <img id="result-display" src="" alt="成品">
    </div>

    <div class="action-btns">
        <button class="btn-reset" onclick="resetSelection()">清除重選</button>
        <button class="btn-make" onclick="checkRecipe()">開始製作</button>
    </div>

    <div id="modal-overlay" class="overlay">
        <div class="modal">
            <h2 id="modal-title">獲得成就</h2>
            <p id="modal-content"></p>
            <button onclick="closeModal()">確定</button>
        </div>
    </div>

    <script>
        // 遊戲狀態
        let currentSelection = { red: 0, white: 0, green: 0, syrup: 0, sweet: 0, salty: 0 };
        let unlockedAchievements = new Set();

        // 譜方定義 (名稱: 組合條件)
        const recipes = [
            { name: "紅龜粿", ingredients: { red: 1, sweet: 1 }, img: "紅米糰.png" }, // 此處替換為對應粿類圖
            { name: "菜頭粿", ingredients: { white: 1, salty: 1 }, img: "白米糰.png" },
            { name: "紅圓", ingredients: { red: 1 }, img: "紅米糰.png" },
            { name: "草仔粿", ingredients: { green: 1, salty: 1 }, img: "綠米糰.png" },
            { name: "芋粿", ingredients: { white: 1, syrup: 1, salty: 1 }, img: "米漿.jpg" },
            { name: "湯圓(甜)", ingredients: { white: 2, sweet: 1 }, isTangyuan: true },
            { name: "湯圓(白)", ingredients: { white: 2 }, isTangyuan: true }
        ];

        function addIngredient(type) {
            currentSelection[type]++;
            const badge = document.getElementById(`count-${type}`);
            badge.innerText = currentSelection[type];
            badge.style.display = 'block';
        }

        function resetSelection() {
            currentSelection = { red: 0, white: 0, green: 0, syrup: 0, sweet: 0, salty: 0 };
            document.querySelectorAll('.badge').forEach(b => b.style.display = 'none');
            document.getElementById('result-display').style.display = 'none';
        }

        function checkRecipe() {
            let found = null;
            
            // 判定邏輯
            for (let recipe of recipes) {
                let match = true;
                for (let key in currentSelection) {
                    const required = recipe.ingredients[key] || 0;
                    if (currentSelection[key] !== required) {
                        match = false;
                        break;
                    }
                }
                if (match) {
                    found = recipe;
                    break;
                }
            }

            if (found) {
                // 成功
                const name = found.isTangyuan ? "湯圓" : found.name;
                unlockedAchievements.add(name);
                showModal("獲得成就", `成功製作：${name}`);
                
                // 顯示成品圖 (此處可替換成品圖路徑)
                const display = document.getElementById('result-display');
                display.src = found.img || "紅米糰.png"; 
                display.style.display = 'block';

                if (unlockedAchievements.size >= 6) { // 假設總共6種
                    setTimeout(() => alert("恭喜完成全成就！領取 LINE 貼圖獎勵！"), 1000);
                }
            } else {
                // 失敗
                showFailureHint();
            }
        }

        function showFailureHint() {
            const locked = recipes.filter(r => {
                const name = r.isTangyuan ? "湯圓" : r.name;
                return !unlockedAchievements.has(name);
            });
            
            if (locked.length > 0) {
                const hint = locked[Math.floor(Math.random() * locked.length)];
                let hintText = "尚未達成成就。提示：試試看 ";
                for(let key in hint.ingredients) {
                    hintText += `${key} x${hint.ingredients[key]} `;
                }
                showModal("製作失敗", hintText);
            }
        }

        function showModal(title, content) {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-content').innerText = content;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal-overlay').style.display = 'none';
        }
    </script>
</body>
</html>
